<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LomyChat — Profile</title>

<!-- Tailwind for fast, consistent styling -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  :root{
    --card:#ffffff;
    --text:#0b1220;
    --muted:#667085;
    --divider:#e6eaf0;
    --brand:#0ea5e9;   /* cyan-blue */
    --brand2:#22c55e;  /* green */
    --bg-overlay: rgba(15,23,42,.55);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --card:#0b121a;
      --text:#e7f0f7;
      --muted:#9db4c7;
      --divider:#1b2633;
      --bg-overlay: rgba(0,0,0,.45);
    }
  }
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font:15px system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
    overflow:hidden; /* page won’t scroll; content area scrolls */
  }

  /* Fixed scenic background that adapts to system theme */
  .bg{
    position:fixed; inset:0; z-index:-1; background-size:cover; background-position:center;
  }
  @media (prefers-color-scheme: light){
    .bg{ background-image:url('https://i.postimg.cc/Y0Wb7Vfc/IMG-20250816-WA0070.jpg'); }
  }
  @media (prefers-color-scheme: dark){
    .bg{ background-image:url('https://i.postimg.cc/QCT9nq8d/IMG-20250816-WA0069.jpg'); }
  }
  .glass{
    background: var(--bg-overlay);
    backdrop-filter: blur(12px);
  }

  /* Hide native file inputs if added later */
  input[type=file]{ position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important; opacity:0 !important; }

  /* Avatar ring */
  .ring-outer{
    background: conic-gradient(#60a5fa,#22c55e,#f59e0b,#60a5fa);
    padding:3px; border-radius:9999px;
  }

  /* QR container */
  .qrBox{
    border:1px solid var(--divider);
    border-radius:14px;
    background:var(--card);
  }

  /* Modal base */
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:40; }
  .modal.show{ display:flex; }
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>

<!-- Header -->
<header class="glass sticky top-0 z-10">
  <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
    <!-- Back to the exact chat -->
    <button id="backBtn" class="w-10 h-10 rounded-xl bg-white/20 hover:bg-white/30 text-white grid place-items-center" title="Back">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>

    <!-- Brand logo and name -->
    <div class="flex items-center gap-2">
      <!-- Real logo placement: top-left brand in header -->
      <div class="w-8 h-8 rounded-lg grid place-items-center">
        <!-- Simple clean logo mark -->
        <img
          class="logo-behind w-12 sm:w-14 md:w-16"
          src="https://i.postimg.cc/d0Vh4kXD/-removebg-preview.png"
          alt="LomyChat Logo"
          width="96"
          height="96"
          />
      </svg>
      </div>
      <div class="text-white font-extrabold text-lg tracking-wide">LomyChat</div>
    </div>

    <div class="ml-auto flex items-center gap-2">
      <!-- Jump to chat list -->
      <a id="toListBtn" href="chatlist.html" class="px-3 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white font-semibold">Chats</a>
    </div>
  </div>
</header>

<!-- Content scroll area -->
<main class="max-w-5xl mx-auto px-4 py-6 overflow-auto h-[calc(100vh-64px)]">
  <!-- Profile Hero -->
  <section class="grid md:grid-cols-[280px_1fr] gap-6 items-start">
    <!-- Left card: avatar + primary actions -->
    <div class="rounded-2xl p-5 glass border border-white/15">
      <div class="grid justify-items-center gap-4">
        <div class="ring-outer">
          <img id="avatarImg" src="https://via.placeholder.com/160" alt="Avatar" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';" class="w-36 h-36 rounded-full object-cover bg-white/10">
        </div>
        <div class="text-center">
          <h1 id="displayName" class="text-2xl font-extrabold text-white">User</h1>
          <p id="username" class="text-sm text-white/80">@username</p>
        </div>

        <!-- Primary actions -->
        <div class="w-full grid grid-cols-2 gap-3">
          <button id="messageBtn" class="px-3 py-2 rounded-xl bg-sky-500 hover:bg-sky-600 text-white font-semibold">Message</button>
          <button id="callBtn" class="px-3 py-2 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-white font-semibold">Call</button>
        </div>

        <!-- Secondary quick toggles -->
        <div class="w-full grid grid-cols-3 gap-3">
          <button id="addContactBtn" class="px-3 py-2 rounded-xl bg-white/20 hover:bg-white/30 text-white font-semibold">Add</button>
          <button id="muteBtn" class="px-3 py-2 rounded-xl bg-white/20 hover:bg-white/30 text-white font-semibold">Mute</button>
          <button id="shareBtn" class="px-3 py-2 rounded-xl bg-white/20 hover:bg-white/30 text-white font-semibold">Share</button>
        </div>
      </div>
    </div>

    <!-- Right card: details + QR + management -->
    <div class="rounded-2xl p-5 bg-[var(--card)] border border-[var(--divider)]">
      <div class="flex items-start gap-4">
        <!-- Big name and status -->
        <div class="flex-1">
          <div class="flex items-center gap-3 flex-wrap">
            <h2 id="fullName" class="text-2xl font-extrabold text-[var(--text)]">User Name</h2>
            <span id="onlineBadge" class="px-2 py-1 rounded-md text-xs font-semibold bg-green-100 text-green-700">Online</span>
          </div>
          <p id="bio" class="mt-2 text-[var(--muted)]">Bio will appear here...</p>

          <!-- Info list -->
          <ul class="mt-4 grid gap-2 text-sm text-[var(--text)]/90">
            <li class="flex items-center gap-2">
              <svg class="w-5 h-5 text-sky-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 12-9 12S3 17 3 10a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
              <span id="location">Somewhere on Earth</span>
            </li>
            <li class="flex items-center gap-2">
              <svg class="w-5 h-5 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 7h-7"/><path d="M14 17H4"/><path d="M14 7v10a4 4 0 0 0 4 4h2V3h-2a4 4 0 0 0-4 4Z"/></svg>
              <span id="joined">Joined: 2025</span>
            </li>
            <li class="flex items-center gap-2">
              <svg class="w-5 h-5 text-indigo-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v8m-4-4h8"/><circle cx="12" cy="12" r="10"/></svg>
              <span id="about">Loves building cool things.</span>
            </li>
          </ul>
        </div>

        <!-- QR code -->
        <div class="qrBox p-3">
          <img id="qrImg" alt="QR Code" class="w-40 h-40 rounded-md" src="" onerror="this.src=''; this.alt='QR failed to load'; this.style.background='#eee';">
          <div class="text-xs text-[var(--muted)] mt-2 text-center">Scan to share profile</div>
        </div>
      </div>

      <!-- Danger zone -->
      <div class="mt-6 grid sm:grid-cols-2 gap-3">
        <button id="blockBtn" class="px-4 py-2 rounded-xl border border-red-300 text-red-700 bg-red-50 hover:bg-red-100 font-semibold">Block user</button>
        <button id="deleteBtn" class="px-4 py-2 rounded-xl border border-red-300 text-red-700 bg-red-50 hover:bg-red-100 font-semibold">Delete chat</button>
      </div>
    </div>
  </section>
</main>

<!-- Call modal -->
<div id="callModal" class="modal">
  <div class="absolute inset-0 bg-black/60" id="callBackdrop"></div>
  <div class="relative w-[min(520px,92vw)] rounded-2xl bg-[var(--card)] border border-[var(--divider)] p-4 shadow-2xl">
    <div class="flex items-center gap-3 mb-3">
      <div class="w-9 h-9 rounded-lg bg-sky-500 grid place-items-center">
        <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.84 19.84 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.84 19.84 0 0 1 2.08 4.18 2 2 0 0 1 4.06 2h3a2 2 0 0 1 2 1.72c.12.9.33 1.77.63 2.6a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.48-1.15a2 2 0 0 1 2.11-.45c.83.3 1.7.51 2.6.63A2 2 0 0 1 22 16.92z"/></svg>
      </div>
      <div>
        <div class="font-bold text-[var(--text)]">Call</div>
        <div id="callWho" class="text-sm text-[var(--muted)]">Connecting…</div>
      </div>
      <button id="hangupBtn" class="ml-auto px-3 py-1.5 rounded-lg bg-rose-600 text-white font-semibold">Hang up</button>
    </div>
    <div class="grid gap-2">
      <video id="selfVideo" autoplay playsinline muted class="w-full rounded-xl bg-black aspect-video"></video>
      <video id="remoteVideo" autoplay playsinline class="w-full rounded-xl bg-black aspect-video"></video>
    </div>
    <div class="flex items-center gap-3 mt-3">
      <button id="startAudio" class="px-4 py-2 rounded-xl bg-sky-600 text-white font-semibold">Audio</button>
      <button id="startVideo" class="px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold">Video</button>
    </div>
  </div>
</div>

<script type="module">
  // Parse query params: uid (profile to view), and optional c & u to return back to exact chat
  const qp = new URLSearchParams(location.search);
  const PROFILE_UID = qp.get('uid') || '';
  const CHAT_ID = qp.get('c') || '';
  const CHAT_OTHER_UID = qp.get('u') || PROFILE_UID || '';

  // Simple demo data fetcher (replace with real data sources later)
  async function fetchUser(uid){
    // In real app, fetch from Firestore users collection. Here we map a few dummies.
    const dummies = {
      dummy1:{ displayName:'Dummy One', username:'dummy1', avatarEmoji:'🟦', bio:'Building cool things.', location:'Paris', joined:'2024', about:'Fan of blue UI.' },
      dummy2:{ displayName:'Dummy Two', username:'dummy2', avatarEmoji:'🟩', bio:'Coffee and code.', location:'Lagos', joined:'2025', about:'Ships fast.' },
      dummy3:{ displayName:'Dummy Three', username:'dummy3', avatarEmoji:'🟪', bio:'Design lover.', location:'Nairobi', joined:'2023', about:'Pixel perfect.' }
    };
    return dummies[uid] || { displayName: uid || 'User', username: uid || 'user', avatarEmoji:'👤', bio:'', location:'Earth', joined:'', about:'' };
  }

  // Elements
  const backBtn = document.getElementById('backBtn');
  const toListBtn = document.getElementById('toListBtn');
  const avatarImg = document.getElementById('avatarImg');
  const displayNameEl = document.getElementById('displayName');
  const usernameEl = document.getElementById('username');
  const fullNameEl = document.getElementById('fullName');
  const bioEl = document.getElementById('bio');
  const locationEl = document.getElementById('location');
  const joinedEl = document.getElementById('joined');
  const aboutEl = document.getElementById('about');
  const qrImg = document.getElementById('qrImg');

  const messageBtn = document.getElementById('messageBtn');
  const callBtn = document.getElementById('callBtn');
  const addContactBtn = document.getElementById('addContactBtn');
  const muteBtn = document.getElementById('muteBtn');
  const shareBtn = document.getElementById('shareBtn');
  const blockBtn = document.getElementById('blockBtn');
  const deleteBtn = document.getElementById('deleteBtn');

  // Call modal els
  const callModal = document.getElementById('callModal');
  const callBackdrop = document.getElementById('callBackdrop');
  const callWho = document.getElementById('callWho');
  const selfVideo = document.getElementById('selfVideo');
  const remoteVideo = document.getElementById('remoteVideo');
  const startAudio = document.getElementById('startAudio');
  const startVideo = document.getElementById('startVideo');
  const hangupBtn = document.getElementById('hangupBtn');

  // Load profile data
  (async function init(){
    const data = await fetchUser(PROFILE_UID);

    // Fill text fields
    displayNameEl.textContent = data.displayName || 'User';
    usernameEl.textContent = '@' + (data.username || 'user');
    fullNameEl.textContent = data.displayName || 'User';
    bioEl.textContent = data.bio || 'No bio yet';
    locationEl.textContent = data.location || 'Unknown';
    joinedEl.textContent = 'Joined: ' + (data.joined || '—');
    aboutEl.textContent = data.about || '—';

    // Avatar:
    // If you have image URLs in your real data, set them here.
    // Fallback: show a generated SVG badge with initials.
    const svgAvatar = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='160' height='160'><rect width='100%' height='100%' rx='80' fill='#0ea5e9'/><text x='50%' y='54%' text-anchor='middle' font-size='72' font-family='Arial' fill='white'>${(data.displayName||'U')[0].toUpperCase()}</text></svg>`);
    avatarImg.src = 'data:image/svg+xml;utf8,' + decodeURIComponent(svgAvatar);

    // QR: points to this user's profile link
    const profileLink = `${location.origin}${location.pathname}?uid=${encodeURIComponent(PROFILE_UID)}`;
    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(profileLink)}`;

    // Primary actions
    messageBtn.onclick = ()=>{
      // If we know chat id and the other uid, go straight there; else, open with just u
      if(CHAT_ID && CHAT_OTHER_UID){
        location.href = `chat.html?c=${encodeURIComponent(CHAT_ID)}&u=${encodeURIComponent(CHAT_OTHER_UID)}`;
      }else{
        location.href = `chat.html?u=${encodeURIComponent(PROFILE_UID)}`;
      }
    };

    callBtn.onclick = ()=>{
      callWho.textContent = `Calling ${data.displayName || 'User'}`;
      callModal.classList.add('show');
    };

    // Utility actions (front-end demos)
    addContactBtn.onclick = ()=> alert('Added to contacts (demo).');
    let muted=false;
    muteBtn.onclick = ()=>{ muted=!muted; muteBtn.textContent = muted? 'Muted':'Mute'; };
    shareBtn.onclick = async ()=>{
      const link = profileLink;
      try{
        if(navigator.share){
          await navigator.share({ title:'LomyChat Profile', text:`${data.displayName}`, url:link });
        }else{
          await navigator.clipboard.writeText(link);
          alert('Profile link copied!');
        }
      }catch{}
    };

    blockBtn.onclick = ()=> confirm(`Block ${data.displayName}?`) && alert('Blocked (demo).');
    deleteBtn.onclick = ()=> confirm('Delete this chat?') && alert('Chat deleted (demo).');
  })();

  // Back returns to the exact chat if we have it; else back to chatlist
  backBtn.onclick = ()=>{
    if(CHAT_ID && CHAT_OTHER_UID){
      location.href = `chat.html?c=${encodeURIComponent(CHAT_ID)}&u=${encodeURIComponent(CHAT_OTHER_UID)}`;
    }else{
      location.href = 'chat.html';
    }
  };

  // Call modal behavior (preview mic/cam; hang up closes)
  let callLocalStream=null, callRemoteStream=null;
  callBackdrop.onclick = endCall;
  hangupBtn.onclick = endCall;
  startAudio.onclick = ()=> startLocal({ audio:true, video:false });
  startVideo.onclick = ()=> startLocal({ audio:true, video:true });

  async function startLocal(constraints){
    try{
      if(callLocalStream) stopStream(callLocalStream);
      callLocalStream = await navigator.mediaDevices.getUserMedia(constraints);
      selfVideo.srcObject = callLocalStream;

      // Mirror to remote for demo preview
      if(callRemoteStream) stopStream(callRemoteStream);
      callRemoteStream = new MediaStream();
      callLocalStream.getTracks().forEach(t=>{
        try{ callRemoteStream.addTrack(t.clone()); }catch{ callRemoteStream.addTrack(t); }
      });
      remoteVideo.srcObject = callRemoteStream;
    }catch(e){
      alert('Call error: '+e.message+(location.protocol!=='https:'?'\nTip: Use HTTPS and allow mic/camera.':''));
    }
  }
  function endCall(){
    callModal.classList.remove('show');
    if(callLocalStream) stopStream(callLocalStream);
    if(callRemoteStream) stopStream(callRemoteStream);
    selfVideo.srcObject = null; remoteVideo.srcObject = null;
  }
  function stopStream(s){ s.getTracks().forEach(t=>t.stop()); }
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97239b71c2ce650f',t:'MTc1NTcxMDkwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
